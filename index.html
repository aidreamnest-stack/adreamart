<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>A Dream Wallpapers ‚Äî 4K & Mobile</title>

<!-- Fonts: fancy + readable -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Pacifico&display=swap" rel="stylesheet">

<meta name="description" content="A Dream Wallpapers ‚Äî free curated 4K & mobile wallpapers. Save favorites, download multi-size, share, and browse by color & category.">

<style>
/* =========================
   THEME VARIABLES (light/dark)
   ========================= */
:root{
  --bg:#06060a; --surface:#0f1115; --muted:#a9a9b0; --accent:#ffb400; --accent-2:#ff6a88;
  --glass: rgba(255,255,255,0.04); --text:#f5f5f7; --card-shadow: 0 8px 30px rgba(0,0,0,0.6);
  --fancy: "Playfair Display", serif; --ui: "Poppins", system-ui, -apple-system;
}
body.light {
  --bg:#ffffff; --surface:#f8f8f8; --muted:#505050; --text:#111111; --glass: rgba(0,0,0,0.03); --card-shadow: 0 8px 30px rgba(0,0,0,0.06);
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; font-family:var(--ui); background:var(--bg); color:var(--text);
  -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
  transition: background .25s ease, color .25s ease;
  overflow-x:hidden;
}

/* PRELOADER */
#preloader{position:fixed; inset:0; display:flex;align-items:center;justify-content:center;background:var(--bg);z-index:99999;flex-direction:column;gap:16px}
#preloader .spinner{width:64px;height:64px;border-radius:50%;border:6px solid rgba(255,255,255,0.06);border-top:6px solid var(--accent);animation:spin 0.9s linear infinite}
#preloader .status{color:var(--muted);font-size:14px;font-weight:600}
@keyframes spin{to{transform:rotate(360deg)}}

/* HEADER */
header{
  position:sticky; top:0; z-index:999; display:flex; justify-content:space-between; align-items:center;
  gap:12px; padding:12px 20px; background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent); backdrop-filter: blur(6px);
  border-bottom:1px solid rgba(255,255,255,0.03);
}
.logo{font-family:'Pacifico',cursive; font-size:24px; letter-spacing:0.3px; color:var(--text);text-decoration:none}
.logo-sub{font-family:var(--fancy); font-weight:600; margin-left:8px; font-size:12px; color:var(--muted)}
.header-left{display:flex; align-items:center; gap:12px;flex-wrap:wrap}
nav{display:flex;gap:4px;flex-wrap:wrap}
nav a { color:var(--muted); margin:0 8px; font-weight:600; font-size:14px;text-decoration:none;transition:color .2s }
nav a:hover{ color:var(--text) }
.header-actions{display:flex; align-items:center; gap:8px;flex-wrap:wrap}
.header-btn{padding:8px 14px; border-radius:8px; background:var(--accent); color:#000; font-weight:700; border:none; cursor:pointer; transition:transform .18s, box-shadow .18s;font-size:14px}
.header-btn:hover{ transform:translateY(-3px); box-shadow:0 8px 24px rgba(255,180,0,0.12) }
.header-btn:active{transform:translateY(-1px)}

/* HERO */
.hero{padding:44px 18px 16px; text-align:center}
.hero h1{font-family:var(--fancy); font-size:44px; margin:0; line-height:1.2; background:linear-gradient(90deg,var(--accent),var(--accent-2)); -webkit-background-clip:text; -webkit-text-fill-color:transparent;background-clip:text}
.hero p{color:var(--muted); margin-top:10px; font-size:16px;max-width:700px;margin-left:auto;margin-right:auto}

/* CONTROLS */
.controls{display:flex; gap:10px; flex-wrap:wrap; justify-content:center; padding:18px 14px}
.controls input[type="search"], .controls select, .controls input[type="email"]{
  padding:10px 12px; border-radius:10px; border:1px solid rgba(255,255,255,0.06); outline:none; min-width:160px; background:var(--surface); color:var(--text);
  box-shadow:var(--card-shadow);transition:border-color .2s;font-family:var(--ui);font-size:14px
}
.controls input:focus, .controls select:focus{border-color:var(--accent)}
.controls button { padding:10px 12px; border-radius:10px; border:none; cursor:pointer; background:var(--accent); color:#000; font-weight:700;transition:transform .2s;font-size:14px}
.controls button:hover{transform:translateY(-2px)}

/* CONTAINER & GRID */
.container{max-width:1250px; margin:0 auto; padding:10px 16px 80px}
.gallery-grid{display:grid; grid-template-columns:repeat(1,1fr); gap:14px}
@media(min-width:640px){ .gallery-grid{grid-template-columns:repeat(2,1fr)}}
@media(min-width:900px){ .gallery-grid{grid-template-columns:repeat(3,1fr)}}
@media(min-width:1200px){ .gallery-grid{grid-template-columns:repeat(4,1fr)}}

.empty-state{text-align:center;padding:60px 20px;color:var(--muted)}
.empty-state h3{font-family:var(--fancy);font-size:24px;margin-bottom:10px;color:var(--text)}

/* CARD */
.card{position:relative; overflow:hidden; border-radius:12px; background:var(--surface); box-shadow:var(--card-shadow); transition:transform .36s cubic-bezier(.2,.9,.3,1),box-shadow .36s}
.card img{width:100%; height:auto; display:block; transition:transform .6s ease;aspect-ratio:16/10;object-fit:cover}
.card:hover{ transform:translateY(-6px);box-shadow:0 12px 40px rgba(0,0,0,0.7) }
.card:hover img{ transform:scale(1.06) }
.card .meta{position:absolute; left:10px; top:10px; background:rgba(0,0,0,0.6); backdrop-filter:blur(10px); padding:6px 8px; border-radius:8px; font-size:13px; color:#fff;font-weight:600}
.card .actions{position:absolute; right:10px; bottom:10px; display:flex; gap:8px}
.icon-btn{background:rgba(0,0,0,0.6); backdrop-filter:blur(10px); color:#fff; border:none; padding:8px 10px; border-radius:8px; cursor:pointer; font-weight:600;transition:all .2s;text-decoration:none;display:inline-block}
.icon-btn:hover{transform:translateY(-4px); background:rgba(0,0,0,0.8)}

/* FAV ICON */
.fav { position:absolute; right:10px; top:10px; background:rgba(0,0,0,0.6); backdrop-filter:blur(10px); border:none; font-size:20px; color:#fff; cursor:pointer; padding:8px 10px;border-radius:8px;transition:transform .2s }
.fav:hover{transform:scale(1.1)}

/* LIGHTBOX */
.lightbox{position:fixed; inset:0; display:none; justify-content:center; align-items:center; z-index:99999; background:linear-gradient(rgba(0,0,0,0.82), rgba(0,0,0,0.9)); padding:20px}
.lightbox.show{display:flex}
.lightbox-inner{display:flex; gap:18px; align-items:center; max-width:95%; max-height:90%;flex-direction:column}
.lightbox img{max-width:90vw; max-height:70vh; border-radius:10px;box-shadow:0 20px 60px rgba(0,0,0,0.8)}
.lb-meta{max-width:600px; color:var(--muted); font-size:14px;background:rgba(255,255,255,0.03);padding:20px;border-radius:12px;width:100%}
.lb-meta h3{margin:0 0 6px 0; font-family:var(--fancy); font-size:20px; color:#fff}
.lb-meta .tags{margin-top:8px; font-size:13px; color:var(--muted)}
.lb-meta .download-controls{margin-top:16px;display:flex;gap:10px;flex-wrap:wrap;align-items:center}

@media(min-width:768px){
  .lightbox-inner{flex-direction:row}
  .lightbox img{max-width:calc(100vw - 400px);max-height:85vh}
  .lb-meta{max-width:320px}
}

/* FAVORITES PANEL */
.fav-panel{position:fixed; right:16px; top:84px; width:320px; max-height:68vh; overflow:auto; background:var(--surface); padding:16px; border-radius:12px; box-shadow:var(--card-shadow); z-index:9999;border:1px solid rgba(255,255,255,0.06)}
.fav-panel h4{margin:0 0 12px 0;font-family:var(--fancy);font-size:18px}
.fav-panel::-webkit-scrollbar{width:8px}
.fav-panel::-webkit-scrollbar-track{background:transparent}
.fav-panel::-webkit-scrollbar-thumb{background:var(--muted);border-radius:4px}

/* BOTTOM CONTROLS */
.controls-bottom{display:flex; justify-content:center; gap:12px; margin-top:18px;flex-wrap:wrap}
.load-more{padding:10px 16px; border-radius:10px; border:1px solid rgba(255,255,255,0.06); background:var(--surface); color:var(--text); cursor:pointer;font-weight:600;transition:all .2s;font-family:var(--ui)}
.load-more:hover{background:var(--accent);color:#000;border-color:var(--accent)}

/* BACK TO TOP */
#backToTop{position:fixed; right:20px; bottom:20px; padding:12px 14px; border-radius:10px; background:var(--accent); color:#000; border:none; cursor:pointer; display:none; z-index:9999;font-weight:700;font-size:16px;box-shadow:0 8px 24px rgba(0,0,0,0.3);transition:transform .2s}
#backToTop:hover{transform:translateY(-4px)}

/* CURSOR */
#cursor{position:fixed; left:0; top:0; pointer-events:none; width:18px; height:18px; border-radius:50%; transform:translate(-50%,-50%); z-index:99999; background: radial-gradient(circle, rgba(255,180,0,0.9) 0%, rgba(255,78,88,0.16) 60%); box-shadow:0 8px 22px rgba(255,180,0,0.08);transition:opacity .2s}

/* ERROR MESSAGE */
.error-banner{background:#ff4444;color:#fff;padding:12px 20px;text-align:center;font-weight:600;display:none}
.error-banner.show{display:block}

/* TOAST */
.toast{position:fixed;left:50%;transform:translateX(-50%);bottom:30px;background:var(--surface);padding:12px 20px;border-radius:10px;z-index:99999;color:var(--text);box-shadow:var(--card-shadow);border:1px solid rgba(255,255,255,0.06);animation:slideUp .3s ease}
@keyframes slideUp{from{bottom:0;opacity:0}to{bottom:30px;opacity:1}}

/* small responsive tweaks */
@media(max-width:768px){
  .hero h1{font-size:32px}
  .controls{padding:12px 10px}
  .controls input, .controls select{min-width:140px;font-size:13px}
  .fav-panel{right:8px;top:auto;bottom:70px;width:calc(100% - 16px);max-height:50vh}
  header{padding:10px 12px;flex-wrap:wrap}
  .header-left{width:100%;justify-content:space-between}
  nav{order:3;width:100%;justify-content:center;margin-top:8px}
  #cursor{display:none}
}
</style>
</head>
<body>

<!-- ERROR BANNER -->
<div id="errorBanner" class="error-banner" role="alert"></div>

<!-- PRELOADER -->
<div id="preloader">
  <div class="spinner" aria-hidden="true"></div>
  <div class="status">Loading wallpapers...</div>
</div>

<!-- CUSTOM CURSOR -->
<div id="cursor" aria-hidden="true"></div>

<header>
  <div class="header-left">
    <a href="#" class="logo">A Dream Wallpapers <span class="logo-sub">4K & Mobile</span></a>
    <nav aria-label="Main navigation">
      <a href="#">Home</a><a href="#gallery">Wallpapers</a><a href="#about">About</a>
    </nav>
  </div>
  <div class="header-actions">
    <button class="header-btn" id="themeToggle" title="Toggle theme" aria-label="Toggle theme">‚òÄÔ∏è</button>
    <button class="header-btn" id="uploadBtn">Upload</button>
    <button class="header-btn" id="favoritesToggle" aria-label="Toggle favorites panel">Favorites <span id="favCount" style="margin-left:8px;background:#fff;color:#000;padding:2px 6px;border-radius:6px;font-weight:700">0</span></button>
  </div>
</header>

<section class="hero">
  <h1>Discover Cinematic 4K & Mobile Wallpapers</h1>
  <p>Curated, downloadable, and easy to save ‚Äî choose sizes, filter by color & category, and make your device shine.</p>
</section>

<!-- Controls -->
<div class="controls" role="region" aria-label="Search and filters">
  <input id="searchInput" type="search" placeholder="Search by title or tag..." aria-label="Search wallpapers">
  <select id="categorySelect" aria-label="Category filter">
    <option value="">All Categories</option>
    <option value="nature">Nature</option>
    <option value="anime">Anime</option>
    <option value="minimal">Minimal</option>
    <option value="abstract">Abstract</option>
    <option value="city">City</option>
    <option value="space">Space</option>
    <option value="gaming">Gaming</option>
  </select>

  <select id="colorSelect" aria-label="Color filter">
    <option value="">All Colors</option>
    <option value="blue">Blue</option>
    <option value="pink">Pink</option>
    <option value="green">Green</option>
    <option value="orange">Orange</option>
    <option value="purple">Purple</option>
    <option value="red">Red</option>
    <option value="yellow">Yellow</option>
  </select>

  <select id="sortSelect" aria-label="Sort by">
    <option value="new">Newest</option>
    <option value="popular">Most Downloaded</option>
  </select>

  <button id="searchBtn" aria-label="Apply filters">Search</button>

  <input id="newsletterEmail" type="email" placeholder="Your email for new wallpapers" aria-label="Newsletter email">
  <button id="newsletterBtn">Subscribe</button>
</div>

<!-- Gallery -->
<div class="container" id="gallery" aria-live="polite">
  <div class="gallery-grid" id="galleryGrid"></div>

  <div class="controls-bottom">
    <button id="loadMoreBtn" class="load-more">Load more</button>
    <button id="infiniteToggle" class="load-more">Enable Infinite Scroll</button>
  </div>
</div>

<!-- LIGHTBOX -->
<div class="lightbox" id="lightbox" aria-hidden="true" role="dialog" aria-modal="true">
  <div class="lightbox-inner">
    <img id="lbImage" src="" alt="Preview">
    <div class="lb-meta">
      <h3 id="lbTitle">Title</h3>
      <div id="lbInfo" style="color:var(--muted);margin-bottom:8px"></div>
      <div class="tags" id="lbTags"></div>
      <div class="download-controls">
        <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap;width:100%">
          <label style="font-size:13px;color:var(--muted);white-space:nowrap">Download size:</label>
          <select id="sizeSelect" style="flex:1;min-width:120px;padding:8px;border-radius:8px;background:var(--surface);color:var(--text);border:1px solid rgba(255,255,255,0.06)">
            <option value="original">Original (4K)</option>
            <option value="1080p">1080p</option>
            <option value="mobile">Mobile</option>
          </select>
        </div>
        <a id="downloadBtn" class="icon-btn" style="margin-top:8px">‚§ì Download</a>
        <button id="shareBtn" class="icon-btn" style="margin-top:8px">‚á™ Share</button>
      </div>
    </div>
  </div>
  <button id="lightboxClose" style="position:absolute;right:20px;top:20px;background:rgba(0,0,0,0.6);backdrop-filter:blur(10px);border:none;color:#fff;font-size:28px;cursor:pointer;width:44px;height:44px;border-radius:8px;display:flex;align-items:center;justify-content:center" aria-label="Close lightbox">‚úñ</button>
</div>

<!-- Favorites Panel -->
<div class="fav-panel" id="favPanel" style="display:none">
  <h4>Your Favorites</h4>
  <div id="favList"></div>
</div>

<!-- Back to top -->
<button id="backToTop" title="Back to top" aria-label="Back to top">‚Üë</button>

<footer style="text-align:center;padding:20px 8px;color:var(--muted);border-top:1px solid rgba(255,255,255,0.03);margin-top:40px"><small>¬© 2025 A Dream Wallpapers ‚Ä¢ Built with care</small></footer>

<script>
/* =========================
   CONFIG: JSON file path
   ========================= */
const EXTERNAL_JSON_PATH = './wallpapers.json'; // Change this to your actual JSON file path

/* =========================
   FALLBACK DATA (used if JSON fails to load)
   ========================= */
const INLINE_WALLPAPERS = [
  { id:101, title:'Mist Mountain', category:'nature', tags:['mountain','mist','fog'], colors:['blue','gray'], sizes:{ original:'https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=1920', '1080p':'https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=1280', mobile:'https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=720' }, downloads: 121, featured:true, date:'2025-01-15' },
  { id:102, title:'Neon City', category:'city', tags:['night','neon','cyberpunk'], colors:['pink','purple'], sizes:{ original:'https://images.unsplash.com/photo-1514565131-fce0801e5785?w=1920', '1080p':'https://images.unsplash.com/photo-1514565131-fce0801e5785?w=1280', mobile:'https://images.unsplash.com/photo-1514565131-fce0801e5785?w=720' }, downloads: 400, date:'2025-01-14' },
  { id:103, title:'Soft Pastel', category:'minimal', tags:['pastel','soft','abstract'], colors:['pink','purple'], sizes:{ original:'https://images.unsplash.com/photo-1557672172-298e090bd0f1?w=1920', '1080p':'https://images.unsplash.com/photo-1557672172-298e090bd0f1?w=1280', mobile:'https://images.unsplash.com/photo-1557672172-298e090bd0f1?w=720' }, downloads: 88, date:'2025-01-13' },
  { id:104, title:'Anime Forest', category:'anime', tags:['forest','anime','nature'], colors:['green'], sizes:{ original:'https://images.unsplash.com/photo-1511497584788-876760111969?w=1920', '1080p':'https://images.unsplash.com/photo-1511497584788-876760111969?w=1280', mobile:'https://images.unsplash.com/photo-1511497584788-876760111969?w=720' }, downloads: 215, date:'2025-01-12' },
  { id:105, title:'Abstract Glow', category:'abstract', tags:['vivid','colorful','digital'], colors:['purple','blue'], sizes:{ original:'https://images.unsplash.com/photo-1550859492-d5da9d8e45f3?w=1920', '1080p':'https://images.unsplash.com/photo-1550859492-d5da9d8e45f3?w=1280', mobile:'https://images.unsplash.com/photo-1550859492-d5da9d8e45f3?w=720' }, downloads: 62, date:'2025-01-11' },
  { id:106, title:'Sunset Cliff', category:'nature', tags:['sunset','ocean','cliff'], colors:['orange','red'], sizes:{ original:'https://images.unsplash.com/photo-1507525428034-b723cf961d3e?w=1920', '1080p':'https://images.unsplash.com/photo-1507525428034-b723cf961d3e?w=1280', mobile:'https://images.unsplash.com/photo-1507525428034-b723cf961d3e?w=720' }, downloads: 510, date:'2025-01-10' },
  { id:107, title:'Galaxy Nebula', category:'space', tags:['galaxy','stars','nebula'], colors:['purple','blue'], sizes:{ original:'https://images.unsplash.com/photo-1462331940025-496dfbfc7564?w=1920', '1080p':'https://images.unsplash.com/photo-1462331940025-496dfbfc7564?w=1280', mobile:'https://images.unsplash.com/photo-1462331940025-496dfbfc7564?w=720' }, downloads: 340, date:'2025-01-09' },
  { id:108, title:'Gaming Setup', category:'gaming', tags:['rgb','gaming','setup'], colors:['red','purple'], sizes:{ original:'https://images.unsplash.com/photo-1538481199705-c710c4e965fc?w=1920', '1080p':'https://images.unsplash.com/photo-1538481199705-c710c4e965fc?w=1280', mobile:'https://images.unsplash.com/photo-1538481199705-c710c4e965fc?w=720' }, downloads: 275, date:'2025-01-08' }
];

/* =========================
   STATE & UTILITIES
   ========================= */
let WALLPAPERS = [];
const state = { 
  filtered:[], 
  visibleCount:8, 
  infinite:false, 
  currentIndex:0,
  isLoading: false,
  jsonLoaded: false
};

const $ = sel => document.querySelector(sel);
const $$ = sel => Array.from(document.querySelectorAll(sel));

/* Custom cursor */
const cursor = $('#cursor');
if(cursor && window.innerWidth > 768){
  document.addEventListener('mousemove', e => { 
    cursor.style.left = e.clientX + 'px'; 
    cursor.style.top = e.clientY + 'px'; 
  });
}

/* =========================
   JSON LOADING
   ========================= */
async function loadWallpapersJSON(){
  const preloader = $('#preloader');
  const statusEl = preloader?.querySelector('.status');
  
  try{
    if(statusEl) statusEl.textContent = 'Fetching wallpapers from JSON...';
    
    const res = await fetch(EXTERNAL_JSON_PATH, {
      cache:'no-store',
      headers: { 'Content-Type': 'application/json' }
    });
    
    if(!res.ok) throw new Error(`HTTP error! status: ${res.status}`);
    
    const data = await res.json();
    
    if(!Array.isArray(data)){
      throw new Error('JSON data is not an array');
    }
    
    if(data.length === 0){
      throw new Error('JSON array is empty');
    }
    
    // Validate data structure
    const validWallpapers = data.filter(item => {
      return item.id && item.title && item.sizes && item.sizes.original;
    });
    
    if(validWallpapers.length === 0){
      throw new Error('No valid wallpapers found in JSON');
    }
    
    WALLPAPERS = validWallpapers;
    state.jsonLoaded = true;
    console.log(`‚úÖ Successfully loaded ${WALLPAPERS.length} wallpapers from JSON`);
    
  } catch(err){
    console.warn('‚ö†Ô∏è Could not load external JSON:', err.message);
    console.log('üì¶ Using fallback inline data');
    WALLPAPERS = INLINE_WALLPAPERS.slice();
    showError(`Using demo data. Place wallpapers.json file at: ${EXTERNAL_JSON_PATH}`);
  } finally {
    state.filtered = WALLPAPERS.slice();
    init();
    hidePreloader();
  }
}

/* =========================
   UI HELPERS
   ========================= */
function hidePreloader(){
  const p = $('#preloader');
  if(p) {
    setTimeout(() => {
      p.style.opacity = '0';
      setTimeout(() => p.style.display = 'none', 300);
    }, 500);
  }
}

function showError(msg){
  const banner = $('#errorBanner');
  if(banner){
    banner.textContent = msg;
    banner.classList.add('show');
    setTimeout(() => banner.classList.remove('show'), 5000);
  }
}

function toast(msg, duration = 2500){
  const existing = document.querySelector('.toast');
  if(existing) existing.remove();
  
  const d = document.createElement('div');
  d.className = 'toast';
  d.textContent = msg;
  document.body.appendChild(d);
  setTimeout(() => d.remove(), duration);
}

/* =========================
   RENDER GALLERY
   ========================= */
function renderGallery(reset=true){
  const grid = $('#galleryGrid');
  if(!grid) return;
  
  if(reset) {
    grid.innerHTML = '';
    state.visibleCount = Math.min(8, state.filtered.length);
  }
  
  if(state.filtered.length === 0){
    grid.innerHTML = '<div class="empty-state" style="grid-column:1/-1"><h3>No wallpapers found</h3><p>Try adjusting your filters or search terms</p></div>';
    $('#loadMoreBtn').style.display = 'none';
    return;
  }
  
  const slice = state.filtered.slice(0, state.visibleCount);
  
  // Remove old cards if re-rendering
  if(!reset){
    const oldCount = grid.children.length;
    for(let i = oldCount; i < slice.length; i++){
      const item = slice[i];
      const card = createCard(item);
      grid.appendChild(card);
    }
  } else {
    slice.forEach(item => {
      const card = createCard(item);
      grid.appendChild(card);
    });
  }
  
  lazyLoad();
  updateFavUI();
  updateLoadMoreBtn();
}

function createCard(item){
  const card = document.createElement('div');
  card.className = 'card';
  
  const isFav = getFavorites().includes(item.id);
  const heartIcon = isFav ? '‚ô•' : '‚ô°';
  
  card.innerHTML = `
    <div style="position:relative">
      <a href="#" class="preview" data-id="${item.id}" aria-label="Open ${escapeHtml(item.title)}">
        <img data-src="${item.sizes['1080p'] || item.sizes.original}" alt="${escapeHtml(item.title)}" loading="lazy" />
      </a>
      <button class="fav" data-id="${item.id}" title="Add to favorites" aria-label="Toggle favorite">${heartIcon}</button>
      <div class="meta">${escapeHtml(item.category)} ‚Ä¢ ${item.downloads || 0}‚Üì</div>
      <div class="actions">
        <button class="icon-btn download-mini" data-id="${item.id}" aria-label="Quick download">‚§ì</button>
        <button class="icon-btn share-mini" data-id="${item.id}" aria-label="Share">‚á™</button>
      </div>
    </div>`;
  
  // Attach event listeners
  const preview = card.querySelector('.preview');
  preview.addEventListener('click', (e) => {
    e.preventDefault();
    openLightboxById(item.id);
  });
  
  const favBtn = card.querySelector('.fav');
  favBtn.addEventListener('click', (e) => {
    e.stopPropagation();
    toggleFavorite(item.id);
    favBtn.textContent = getFavorites().includes(item.id) ? '‚ô•' : '‚ô°';
    updateFavUI();
  });
  
  const downloadBtn = card.querySelector('.download-mini');
  downloadBtn.addEventListener('click', (e) => {
    e.stopPropagation();
    handleQuickDownload(item.id);
  });
  
  const shareBtn = card.querySelector('.share-mini');
  shareBtn.addEventListener('click', (e) => {
    e.stopPropagation();
    openShareDialog(item);
  });
  
  return card;
}

function updateLoadMoreBtn(){
  const btn = $('#loadMoreBtn');
  if(!btn) return;
  
  if(state.visibleCount >= state.filtered.length){
    btn.style.display = 'none';
  } else {
    btn.style.display = 'block';
    btn.textContent = `Load more (${state.filtered.length - state.visibleCount} remaining)`;
  }
}

/* =========================
   LAZY LOADING
   ========================= */
function lazyLoad(){
  const imgs = document.querySelectorAll('img[data-src]');
  
  if('IntersectionObserver' in window){
    const obs = new IntersectionObserver((entries, observer) => {
      entries.forEach(entry => {
        if(entry.isIntersecting){
          const img = entry.target;
          img.src = img.dataset.src;
          img.removeAttribute('data-src');
          observer.unobserve(img);
        }
      });
    }, {rootMargin:'100px'});
    
    imgs.forEach(img => obs.observe(img));
  } else {
    imgs.forEach(img => {
      img.src = img.dataset.src;
      img.removeAttribute('data-src');
    });
  }
}

/* =========================
   FILTERS & SEARCH
   ========================= */
function applyFilters(){
  const q = $('#searchInput').value.trim().toLowerCase();
  const cat = $('#categorySelect').value;
  const color = $('#colorSelect').value;
  const sort = $('#sortSelect').value;
  
  state.filtered = WALLPAPERS.filter(item => {
    const matchQ = q === '' || 
      item.title.toLowerCase().includes(q) || 
      (item.tags && item.tags.some(tag => tag.toLowerCase().includes(q)));
    
    const matchCat = !cat || item.category === cat;
    const matchColor = !color || (item.colors && item.colors.includes(color));
    
    return matchQ && matchCat && matchColor;
  });
  
  // Sort
  if(sort === 'popular'){
    state.filtered.sort((a,b) => (b.downloads || 0) - (a.downloads || 0));
  } else if(sort === 'new'){
    state.filtered.sort((a,b) => {
      const dateA = a.date || '2025-01-01';
      const dateB = b.date || '2025-01-01';
      return dateB.localeCompare(dateA);
    });
  }
  
  state.visibleCount = Math.min(8, state.filtered.length);
  renderGallery(true);
  
  // Scroll to gallery
  $('#gallery')?.scrollIntoView({ behavior: 'smooth', block: 'start' });
}

// Attach filter event listeners
$('#searchBtn')?.addEventListener('click', applyFilters);
$('#searchInput')?.addEventListener('keyup', e => {
  if(e.key === 'Enter') applyFilters();
});
$('#categorySelect')?.addEventListener('change', applyFilters);
$('#sortSelect')?.addEventListener('change', applyFilters);
$('#colorSelect')?.addEventListener('change', applyFilters);

/* =========================
   LOAD MORE & INFINITE SCROLL
   ========================= */
$('#loadMoreBtn')?.addEventListener('click', () => {
  const prevCount = state.visibleCount;
  state.visibleCount = Math.min(state.visibleCount + 8, state.filtered.length);
  
  if(state.visibleCount > prevCount){
    renderGallery(false);
  }
});

$('#infiniteToggle')?.addEventListener('click', () => {
  state.infinite = !state.infinite;
  const btn = $('#infiniteToggle');
  if(btn){
    btn.textContent = state.infinite ? 'Disable Infinite Scroll' : 'Enable Infinite Scroll';
    toast(state.infinite ? 'Infinite scroll enabled' : 'Infinite scroll disabled');
  }
});

let scrollTimeout;
window.addEventListener('scroll', () => {
  // Infinite scroll
  if(state.infinite && !state.isLoading){
    const scrollPosition = window.innerHeight + window.scrollY;
    const threshold = document.body.offsetHeight - 400;
    
    if(scrollPosition >= threshold && state.visibleCount < state.filtered.length){
      clearTimeout(scrollTimeout);
      scrollTimeout = setTimeout(() => {
        state.visibleCount = Math.min(state.visibleCount + 8, state.filtered.length);
        renderGallery(false);
      }, 200);
    }
  }
  
  // Back to top button
  const backBtn = $('#backToTop');
  if(backBtn){
    backBtn.style.display = window.scrollY > 600 ? 'block' : 'none';
  }
});

/* =========================
   LIGHTBOX
   ========================= */
const lightbox = $('#lightbox');
const lbImage = $('#lbImage');
const lbTitle = $('#lbTitle');
const lbInfo = $('#lbInfo');
const lbTags = $('#lbTags');
const sizeSelect = $('#sizeSelect');

function openLightboxById(id){
  const idx = state.filtered.findIndex(x => x.id === id);
  if(idx === -1) return;
  state.currentIndex = idx;
  showLightbox(state.filtered[idx]);
}

function showLightbox(obj){
  if(!lightbox || !lbImage || !lbTitle || !lbInfo) return;
  
  lbImage.src = obj.sizes.original;
  lbImage.alt = obj.title;
  lbTitle.textContent = obj.title;
  lbInfo.textContent = `${obj.category} ‚Ä¢ ${(obj.downloads || 0)} downloads`;
  
  if(lbTags){
    lbTags.innerHTML = obj.tags ? 
      obj.tags.map(tag => `<span style="background:rgba(255,255,255,0.1);padding:4px 8px;border-radius:6px;margin-right:6px;display:inline-block;margin-bottom:6px">#${escapeHtml(tag)}</span>`).join('') : 
      '';
  }
  
  if(sizeSelect) sizeSelect.value = 'original';
  
  const downloadBtn = $('#downloadBtn');
  if(downloadBtn){
    downloadBtn.onclick = () => {
      const size = sizeSelect?.value || 'original';
      const url = obj.sizes[size] || obj.sizes.original;
      triggerDownload(url, `${obj.title.replace(/\s+/g,'_')}_${size}.jpg`);
      obj.downloads = (obj.downloads || 0) + 1;
      lbInfo.textContent = `${obj.category} ‚Ä¢ ${obj.downloads} downloads`;
      toast('Download started!');
    };
  }
  
  const shareBtn = $('#shareBtn');
  if(shareBtn){
    shareBtn.onclick = () => openShareDialog(obj);
  }
  
  lightbox.classList.add('show');
  lightbox.setAttribute('aria-hidden', 'false');
  document.body.style.overflow = 'hidden';
}

function closeLightbox(){
  if(!lightbox) return;
  lightbox.classList.remove('show');
  lightbox.setAttribute('aria-hidden', 'true');
  if(lbImage) lbImage.src = '';
  document.body.style.overflow = '';
}

$('#lightboxClose')?.addEventListener('click', closeLightbox);

// Keyboard navigation
document.addEventListener('keydown', e => {
  if(!lightbox?.classList.contains('show')) return;
  
  if(e.key === 'Escape') closeLightbox();
  if(e.key === 'ArrowRight') navigate(1);
  if(e.key === 'ArrowLeft') navigate(-1);
});

// Close on backdrop click
lightbox?.addEventListener('click', (e) => {
  if(e.target === lightbox) closeLightbox();
});

function navigate(dir){
  let i = state.currentIndex + dir;
  if(i < 0) i = state.filtered.length - 1;
  if(i >= state.filtered.length) i = 0;
  state.currentIndex = i;
  showLightbox(state.filtered[i]);
}

/* =========================
   DOWNLOAD & SHARE
   ========================= */
function triggerDownload(url, filename){
  const a = document.createElement('a');
  a.href = url;
  a.download = filename || 'wallpaper.jpg';
  a.target = '_blank';
  document.body.appendChild(a);
  a.click();
  setTimeout(() => a.remove(), 100);
}

function handleQuickDownload(id){
  const obj = WALLPAPERS.find(x => x.id === id);
  if(!obj) return;
  
  triggerDownload(obj.sizes.original, obj.title.replace(/\s+/g,'_') + '.jpg');
  obj.downloads = (obj.downloads || 0) + 1;
  
  // Update the card's download count
  renderGallery(false);
  toast('Download started!');
}

function openShareDialog(obj){
  if(navigator.share){
    navigator.share({
      title: obj.title,
      text: `${obj.title} ‚Äî A Dream Wallpapers`,
      url: obj.sizes.original
    }).catch(() => {});
  } else {
    const url = encodeURIComponent(obj.sizes.original);
    const text = encodeURIComponent(`${obj.title} ‚Ä¢ A Dream Wallpapers`);
    window.open(`https://twitter.com/intent/tweet?url=${url}&text=${text}`, '_blank', 'width=550,height=420');
  }
}

/* =========================
   FAVORITES (localStorage)
   ========================= */
function getFavorites(){
  try {
    return JSON.parse(localStorage.getItem('adw_favs') || '[]');
  } catch {
    return [];
  }
}

function setFavorites(arr){
  try {
    localStorage.setItem('adw_favs', JSON.stringify(arr));
    updateFavUI();
  } catch(e) {
    console.error('Failed to save favorites:', e);
  }
}

function toggleFavorite(id){
  const favs = getFavorites();
  if(favs.includes(id)){
    setFavorites(favs.filter(x => x !== id));
    toast('Removed from favorites');
  } else {
    favs.push(id);
    setFavorites(favs);
    toast('Added to favorites');
  }
}

function updateFavUI(){
  const list = $('#favList');
  const favCount = $('#favCount');
  if(!list) return;
  
  list.innerHTML = '';
  const favs = getFavorites();
  
  if(favCount) favCount.textContent = favs.length;
  
  if(favs.length === 0){
    list.innerHTML = '<p style="color:var(--muted);font-size:14px;text-align:center;padding:20px 0">No favorites yet</p>';
    return;
  }
  
  favs.slice().reverse().forEach(id => {
    const obj = WALLPAPERS.find(x => x.id === id);
    if(!obj) return;
    
    const node = document.createElement('div');
    node.style.cssText = 'display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;padding:8px;background:rgba(255,255,255,0.02);border-radius:8px;gap:8px';
    
    node.innerHTML = `
      <div style="display:flex;gap:10px;align-items:center;flex:1;min-width:0">
        <img src="${obj.sizes['1080p'] || obj.sizes.original}" 
             style="width:60px;height:40px;object-fit:cover;border-radius:6px;flex-shrink:0"
             alt="${escapeHtml(obj.title)}">
        <div style="min-width:0;flex:1">
          <div style="font-weight:600;font-size:13px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">${escapeHtml(obj.title)}</div>
          <div style="color:var(--muted);font-size:12px">${escapeHtml(obj.category)}</div>
        </div>
      </div>
      <div style="display:flex;gap:6px;flex-shrink:0">
        <button class="icon-btn" style="font-size:12px;padding:6px 8px" onclick="openLightboxById(${obj.id})" aria-label="View ${escapeHtml(obj.title)}">View</button>
        <button class="icon-btn" style="font-size:12px;padding:6px 8px" onclick="removeFav(${obj.id})" aria-label="Remove from favorites">‚úñ</button>
      </div>
    `;
    
    list.appendChild(node);
  });
}

function removeFav(id){
  const arr = getFavorites();
  setFavorites(arr.filter(x => x !== id));
  renderGallery(false);
}

// Toggle favorites panel
$('#favoritesToggle')?.addEventListener('click', () => {
  const panel = $('#favPanel');
  if(!panel) return;
  
  if(panel.style.display === 'none'){
    panel.style.display = 'block';
    updateFavUI();
  } else {
    panel.style.display = 'none';
  }
});

// Close favorites panel when clicking outside
document.addEventListener('click', (e) => {
  const panel = $('#favPanel');
  const toggle = $('#favoritesToggle');
  
  if(panel && toggle && 
     panel.style.display !== 'none' && 
     !panel.contains(e.target) && 
     !toggle.contains(e.target)){
    panel.style.display = 'none';
  }
});

/* =========================
   NEWSLETTER
   ========================= */
$('#newsletterBtn')?.addEventListener('click', () => {
  const emailInput = $('#newsletterEmail');
  if(!emailInput) return;
  
  const email = emailInput.value.trim();
  
  if(!email || !email.includes('@') || !email.includes('.')){
    toast('Please enter a valid email address', 3000);
    return;
  }
  
  try {
    const subs = JSON.parse(localStorage.getItem('adw_news') || '[]');
    
    if(subs.some(s => s.email === email)){
      toast('You\'re already subscribed!', 3000);
      emailInput.value = '';
      return;
    }
    
    subs.push({
      email,
      date: new Date().toISOString()
    });
    
    localStorage.setItem('adw_news', JSON.stringify(subs));
    emailInput.value = '';
    toast('‚úÖ Thanks for subscribing! (Demo mode - connect to real service)', 3000);
  } catch(e) {
    toast('Failed to save subscription', 2500);
  }
});

/* =========================
   THEME TOGGLE
   ========================= */
function applyTheme(isLight){
  if(isLight){
    document.body.classList.add('light');
  } else {
    document.body.classList.remove('light');
  }
  
  try {
    localStorage.setItem('adw_theme', isLight ? 'light' : 'dark');
  } catch(e) {
    console.error('Failed to save theme:', e);
  }
  
  const toggle = $('#themeToggle');
  if(toggle) toggle.textContent = isLight ? 'üåô' : '‚òÄÔ∏è';
}

$('#themeToggle')?.addEventListener('click', () => {
  const isLight = document.body.classList.toggle('light');
  applyTheme(isLight);
});

// Load saved theme
(function loadTheme(){
  try {
    const savedTheme = localStorage.getItem('adw_theme');
    applyTheme(savedTheme === 'light');
  } catch {
    applyTheme(false);
  }
})();

/* =========================
   BACK TO TOP
   ========================= */
$('#backToTop')?.addEventListener('click', () => {
  window.scrollTo({ top: 0, behavior: 'smooth' });
});

/* =========================
   UPLOAD BUTTON
   ========================= */
$('#uploadBtn')?.addEventListener('click', () => {
  toast('Upload feature coming soon! Connect to your backend.', 3000);
  // Replace with: window.location.href = '/upload';
});

/* =========================
   UTILITIES
   ========================= */
function escapeHtml(text){
  const div = document.createElement('div');
  div.textContent = text;
  return div.innerHTML;
}

/* =========================
   INITIALIZATION
   ========================= */
function init(){
  if(!WALLPAPERS || WALLPAPERS.length === 0){
    WALLPAPERS = INLINE_WALLPAPERS.slice();
  }
  
  state.filtered = WALLPAPERS.slice();
  renderGallery(true);
  updateFavUI();
  
  console.log('üé® A Dream Wallpapers initialized');
  console.log(`üìä Loaded ${WALLPAPERS.length} wallpapers`);
  console.log(`üîó JSON source: ${state.jsonLoaded ? 'External file' : 'Fallback data'}`);
}

// Start loading
loadWallpapersJSON();

</script>
</body>
</html>
